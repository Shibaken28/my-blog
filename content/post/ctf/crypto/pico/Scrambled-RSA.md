---
title: "picoGym - Scrambled RSA"
date: 2022-05-11T22:40:59+09:00
draft: true
---

## 概要

Hmmm I wonder if you have learned your lesson... Let's see if you understand RSA and how the encryption works. Connect with `nc mercury.picoctf.net 47987`.

## 解法
まず，`nc`するとパラメータ$n,e$と，flagの暗号化された値だと思われる数字が示される．
```
flag: 10922881320223452063466704722870116686773647228452773015104730620965883043715179243434180753787331658743679275274323287823769473016591558101783450248814652664808728331934795555566562478204779679963218278269262808277569647931824626074227810124869494554855247701924136814566857951527606516288173235712426861737268342364266936552243101092209243853885993366985795742672501415497873055205984113537843867750692393244233949742966194390343376647406239337900631863899722948409982219608520166922962496916575597963017342688898166219149703286463546483086844588790867352475107866473268625579204860354959667455820292819241651580323065699130721801648066801797649807345847365346117585464733164781911820898861608436832220238661628530417033936495697134048385138102581017629036938414248280587561586556751675645719728618198752932259225869872872312265413621223138241415302544602179635587402098180551148552445236931041454643479094253258399388989051063185977139668234217337847721623719296483108087992866714303416640209584205124078487421411620052058743556364431893756843497892041417036303454259821274208638022522973168743029696382505199693134424543416463332375777063600203552631556296388729892301078392228087708922107533071078915121557890218507664083122649180338126201437453345398235411535795870052583358019368403502477511319742761689108613554196860408290659782030079526280641177198489991216840234148870182553475768285169750819846824219598995760369626178845003361692821945489796464389232593908474464333123621471990688272154834341298336397694196052617468143914253335250578517821556349875646144103476875148934857087397317112422536915934309874987318227841442942237003993382332976205470765187271998444439550994211950795866226857802662356119909608658447408970788098618446249058142961984869675763938729245604872780515822996702054155908913785453115613631818199200122676759781053267305650074318682290680364316634223284611099922731343209770024335430681742822076495889333539828646436253851255420388510086909194988909977748866278252916536020540836639105345259013697140256523999582194130346856409138570618926044354892262715636987620886456394291235103864462726407937900109366722742366390568703071870062473764108294940197811051745759107744543942376597517722410138194516681247108301434621703138594773812780642960574204473975287973361294429658555632791777851828020627837730154914009528643715550425224214222428927325024839444404480132884287976454221651355172022938353291263229288589112299246833202552857853907061419722624770860842542821526195407891616465860515035416017912057545923881984927436583186139007780820067712138550884264948303292986112312631908551263285272971331564013339043251471491774563953543426979461315812362102642315730134751792831675745036384572172968997243572317609655889635407835623436710500363538796640221416576377887184721125651479957937530769950872016457375146273828862145111925603598125159232598882426380244422858864780560118645516197209621914299573024898993420817899798456888331232839216419090494585041224863633667526754240304825439709289412386818827925979721152590351624422800756216524287976433662835118990658145754499117884023311554098897679513957021271895799145127513452308620625337615351495873395780275008168421831931924495003695961819995664251307216704308116717459467596803875998806569311663313116292679128496385453107130776629212898921484132029485373236672636883269061447299231559679499919170592949331973437074724655271173470934142321398361498394386544090765618650203884430497166060023430744482643726898005279104367552024316037540787399041398223056956016331700162774605986953267029528088293859734163961258918992074318670252025109812320084284942516260194206130728740941580012676988921007852869472919778892580452628710589318492698963610256821377163157794577863037591126971271192922076219803212463144843290017007712946584473698146764852514013369417331042729029651915067425296527052191349181652127508496638274179804480982383208172681351888595694873091499136343179199928560758293169291554558833940467540654760815079484467112084957125266546808500873316606192911642493297639354991618027628360581618841337211632719390201711640404655493172605678389266110288201500975842542452003773162866082063100619426854173243759373236604157523811844294689941404647392281663022408538109176250660728866692362375150445455777869101867368773184237834517978377806132135340311286124675548667074982805187780425984354393310325921931391178349846308797357282066321401746533321176867914205499737862515055790964638217009950874261636927235597637872295590332667918152987856505823587157705126099358033329072893177280886901153668047910307241130630592266204927264907492195005457723777956647527688818529134424764158323835935642338889219445888714006152542123960165317668823306034966704350995806788069935256933021001653366121585801083776805340101691587543115264779759550642310957954098704689343486625800915252675188283303686566300712045547569891764751224667142468906448164281793387152777047938235343107619673281690671428650578903968199414034565309619974079779245331228578594520490118544646154807965178078599738256439230261238309697849545788492056868974654046157804086527004959959173684869020600610260389881036656174298421650664466517028320481866882567521953356090073288784042994645109092044499952764994835201066181281759253439657111938486387770654449462936538847359481469614768703448775593098688331020404647560461925274390750795757971161030227587230583554937011017564611319366519882396497291707219682811581178712345346305193734773665120732954755182164582442494063268468947874991513000112171241965035743893939792362213664606871970981286554640454211996659369310961049466019158475408387908847468219817090386350970539757899832280723293352335993360012343490892860853033035331807397024888606281571195185550392849441209228270010865727063840421463084397793740843248874050773056945801526337712812541621481467640292208178402233660826540718929062652931042433418234132684385565939289312395439277070831599103597565682278841416126131834820487278903509390887512076977737439973895366111707651063507973310786128794813591472123119911575338221408980438914005045873090111722024841019486125314627290747865656512539827716714212040666518321621449087568000826009440084832537596161252568419957720628489742961126174439673177869200817689335215330518701899488038897363550358759565487141222632727242949663751485020959197943114399474177812092173483312317224490495130921137791881738398862383268739438828750442179854206497996715830063913881574388765269484396587465325934544184828099838470911651135682774812300520158909998316193952573158276587016096640422618570010465549912219001292416859099076261881683056584196856410095639055440208014113806936511475396755422103872185544946963781027478582934302136874661526772791849626374543562043121901824302835064483071605931574446529834697442985577344042981032413925587460736127405854910707866268234646877407002628314488434296888689512470576150655347622766906118871433036763631485347309663250275113177275305893049798699431260414206011255773080461659099969738107991611448893725120164227748612183087310666025817856627290818576404873242584736455782492123327890300369190802584869057242765473985700620485201662378238040450823738311963147316997593919894140783539060004729292119632193576835311720701832203014446830334470147750846241403136789714890437507635359013309025385307460448139389064581154739880723592126452871094666060563809033477531618017103121834948711430463033384729486558880481126154059864611836923725407552444907138759602705329181326018608700491633321325334551969134065272603499884276380210182023304280313746615509097208189121607879808294672228585479848383980274484656220575503226053837783672759270442455849563385254066805017925782204913963522464867250498380802154301555034317785829822553383112394611172555758542362437960473988774813612644598831116882491648538214803126263226130997615669164677435345570093346750870821911676447169217998208196963725145013496562696777759045736564319818121543175383154777283654203571829716962392957989692042350794078294
n: 60661206418812407406277586750478507540653593265255359337201269815717754607576131118198475818727865946438213921672870358220441277382982274695540916421675975077077902918225274340667392953737753078269784623921015068386368832504823138723908118582856970077512109867788593874414952796946309039140065878863663663703
e: 65537
I will encrypt whatever you give me: 
```

そして，好きな入力を同じ手法で暗号化してくれる．

```
6855905081549062300466251
I will encrypt whatever you give me: abcde
Here you go: 3447515168128731950795371995812756518818600606251739256231172414786291408720273273157399460045390221997757562984237391012598393889577436843003111954998257455166007949764791690471588079197745368424198681192086753898416339090681978069066029565636192804427190395888027773221213645828475447999794821834160529480289821300977333622403667386510099330584402199934128821519449025828790845289685805863503319791637690392599715846675871980631772890039009734925263694743684498081084258757483635417848947153531111912783414028794046707898962437482173986851063298169517776104727941081202780313172608824586346546843129998708201250001562250455805716305672230140611695721091988930592670926317568805438836375258454459226028710819008831188986633131750664840937115840767158263908878366324692526628636084002208833953088968143670142208023367915118731947478904667247725386986845951706601318237064960515786042422659837707482207919021290957557816936012624494300122886790378771981164511039455867009418934217260905401405237966400224010299909428247195200908041527077517086358730268586849296921653504855803375641771967866769780288499916539207931662683983289445990678001790671786326474798841106012685153001764809812181593567705036023736272766633353696050579189052734158673118971882028494986512410944095929602855186111717340594549416254063517309537829894613020512857471005348230410048138910042292754420080473731335527427578754706618440228463926296179406193326199004439686689274467849351460216529236392948864214453766709095659335236306606251182580376855905081549062300466251
I will encrypt whatever you give me: a
Here you go: 34158673118971882028494986512410944095929602855186111717340594549416254063517309537829894613020512857471005348230410048138910042292754420080473731335527427578754706618440228463926296179406193326199004439686689274467849351460216529236392948864214453766709095659335236306606251182580376855905081549062300466251
I will encrypt whatever you give me: b
Here you go: 17827812784039143997362246239889993903820693583423944310945828529478048301258030166668240750832633966076004131116116608744199394400405199673339316232669827003631583925917780091804163706882379341261702223916574464776261945504045489452748389579320810269898083156621260547815192639856361407868120503864709437316
I will encrypt whatever you give me: c
Here you go: 6111707836182559081820385706662777541339146730885202789208809660296173828417502697987109152916712628990818782022213862535335542866776066728715853640689080047031608287117288368236253331746361304694356169267082749235307823647930990397613992411970533249951319407211779343242504615648481537253034372757552737855
I will encrypt whatever you give me: d
Here you go: 122833041882954815108607704864155304965312512601937803674187285069790147444766510923064230301372632060816988614234560309988922021336966829464017004622383711452072982749562148746188020139211925739957932054764323390176047901208141597288918711024561202663777651470120480769920984836092522642029142246993530919874
I will encrypt whatever you give me: e
Here you go: 57751750089110096618140410272544302005075142745399513105856613171661560556054714045997618237490675228540306185966861351182823541042933554631892655640980648387782031070570105016592397693757843487456567750945420250898401963321912659080444013580590771618585485249207363303066911722998307614326781911610103060147
```

いろいろな入力で試行錯誤すると，次のことがわかる
- 入力の長さと出力の長さが比例する
- 同じ入力のときでも出力が異なる場合がある

各一文字に対しての出力が連結されているとも予想できるが，どうもそうではないらしい．
同じ数字の並びが出てきたり出てこなかったりする．何かしらの連結であることは間違いなさそうである．

```
a　  = 99524164099589650867722515743472740436748725909395577684305478919877946778273854471479703867740646817717861038777832771309916398462630441569259769719829865578278895615220706385592562653110361958666720975655033934641178814904381386858432276384057345302035339030237809271257017205868829157804332221399488402355
aa   = 99524164099589650867722515743472740436748725909395577684305478919877946778273854471479703867740646817717861038777832771309916398462630441569259769719829865578278895615220706385592562653110361958666720975655033934641178814904381386858432276384057345302035339030237809271257017205868829157804332221399488402355
       63365353263388674693711092715202917811472048837456058702818780768775723780712489239013597046512930460533798288849942087160425916701620998690558856417868056176912687721698186445919999460480994918605196895766962024665203831042270904287656841731896179340574228807178242937503756077389149408189478989658793386675
aaa  = 63365353263388674693711092715202917811472048837456058702818780768775723780712489239013597046512930460533798288849942087160425916701620998690558856417868056176912687721698186445919999460480994918605196895766962024665203831042270904287656841731896179340574228807178242937503756077389149408189478989658793386675
       5749370167134389880573937959143684421011892893078099137702236579686322095508080424493728169516931477411577902217580229975087285428168488303272262472682384847354933049489790882211765334528645677471813261832970535931096955219439184683266364639327071354798267224170495757994311565319971525901943263603430493429
       99524164099589650867722515743472740436748725909395577684305478919877946778273854471479703867740646817717861038777832771309916398462630441569259769719829865578278895615220706385592562653110361958666720975655033934641178814904381386858432276384057345302035339030237809271257017205868829157804332221399488402355
aaaa = 99524164099589650867722515743472740436748725909395577684305478919877946778273854471479703867740646817717861038777832771309916398462630441569259769719829865578278895615220706385592562653110361958666720975655033934641178814904381386858432276384057345302035339030237809271257017205868829157804332221399488402355
       63365353263388674693711092715202917811472048837456058702818780768775723780712489239013597046512930460533798288849942087160425916701620998690558856417868056176912687721698186445919999460480994918605196895766962024665203831042270904287656841731896179340574228807178242937503756077389149408189478989658793386675
       115733529574478422846417653759089560764940193086128041506188601769683232540053042512633750844021722320212132315253810362642153756448602751163135248264399195760682059105904307866922625353563158535805256404182789333336151421895846607578824008881552237025973710699023326068994487231055974488020035577497144626611
       5749370167134389880573937959143684421011892893078099137702236579686322095508080424493728169516931477411577902217580229975087285428168488303272262472682384847354933049489790882211765334528645677471813261832970535931096955219439184683266364639327071354798267224170495757994311565319971525901943263603430493429
aaaaa= 63365353263388674693711092715202917811472048837456058702818780768775723780712489239013597046512930460533798288849942087160425916701620998690558856417868056176912687721698186445919999460480994918605196895766962024665203831042270904287656841731896179340574228807178242937503756077389149408189478989658793386675
       99524164099589650867722515743472740436748725909395577684305478919877946778273854471479703867740646817717861038777832771309916398462630441569259769719829865578278895615220706385592562653110361958666720975655033934641178814904381386858432276384057345302035339030237809271257017205868829157804332221399488402355
       57493701671343898805739379591436844210118928930780991377022365796863220955080804244937281695169314774115779022175802299750872854281684883032722624726823848473549330494897908822117653345286456774718132618329705359310969552194391846832663646393270713547982672241704957579943115653199715259019432636034304934294
       9752022950004849579756836863531625565003533923323015236725562821004038265306194319214017568829553016563617976192471971994395002553862883253119703624544506960686944393073195190835713064477844036793121556959784655480639438459540304742522027573726555301946552488909652480650995408940924974485450118328379029262
       115733529574478422846417653759089560764940193086128041506188601769683232540053042512633750844021722320212132315253810362642153756448602751163135248264399195760682059105904307866922625353563158535805256404182789333336151421895846607578824008881552237025973710699023326068994487231055974488020035577497144626611
```
同じ並びを見つけたら区切るようにすると，
`a`の出力が`aa`に含まれていて，`aa`の出力も`aaa`に含まれていることがわかる．
もう少し詳しく見てみる．

```
I will encrypt whatever you give me: ab
Here you go: 6694538818832945567385287760929134576639910646874947947936677072768851534144544730927585773405378198587943155437575744730182724053779685508342602194617191678272583637308815022939070437479930645525224268715870219669471093948090974795905101014538123459728294239310308242833838353290222886283005293427868466676598274460256622569100325222845584378979625415545981815902556492846702694358546680740640221630953878770172564060937298196671311504028676702083810921442684503236885009743939708797919797030828488782765595213636805025728508695318738501072841053155537543129504262540599124814609706315688912421860229313059487740159
I will encrypt whatever you give me: ac
Here you go: 3005235319479952222250489039772970566340587373463717961260392098288764167684985975859481152464096042268774057939661450398578511494033841430799439782252250964695004439947049112593147148114761595440314995270210371940085906537585409840823904228301531551345781150426293746133419556974259819430428451159764890352698274460256622569100325222845584378979625415545981815902556492846702694358546680740640221630953878770172564060937298196671311504028676702083810921442684503236885009743939708797919797030828488782765595213636805025728508695318738501072841053155537543129504262540599124814609706315688912421860229313059487740159
I will encrypt whatever you give me: aa
Here you go: 98274460256622569100325222845584378979625415545981815902556492846702694358546680740640221630953878770172564060937298196671311504028676702083810921442684503236885009743939708797919797030828488782765595213636805025728508695318738501072841053155537543129504262540599124814609706315688912421860229313059487740159
90548973459967898103676521026124724703852516940023848727692200571709839244435467995918547774623877346639924826652855148975646272519090827434110677608883207110359180333767527387754187825744310113670202853041147939596713162513609843793632494069563612421895837843538269192780377339961414877803195875597695389959
I will encrypt whatever you give me: a
Here you go: 98274460256622569100325222845584378979625415545981815902556492846702694358546680740640221630953878770172564060937298196671311504028676702083810921442684503236885009743939708797919797030828488782765595213636805025728508695318738501072841053155537543129504262540599124814609706315688912421860229313059487740159
```
1桁目が`1`のとき`118...`，`2`のとき`262...`，
2桁目が`1`のとき`563...`，`2`のとき`481...`が含まれ，ランダムな順番で結合されていることがわかる．

つまり，法則は，
- $a$桁目の文字$b$に対応する数が決まっている．これを$f(a,b)$とする
- 入力の各文字に対して$f(a,b)$が計算され，これがランダムな順番で結合されて出力される．
ということがわかる，

これを解くには，各$a,b$の組み合わせに対して，$f(a,b)$の値を知っておく必要がある．
フラグ長は26文字程度だとわかるので，
